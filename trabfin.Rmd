---
output:
  html_document:
    toc: true
    df_print: paged
  encoding: UTF-8
  pdf_document:
    toc: true
  word_document:
    toc: true
---

# Relatório de R

O presente documento foi construído para a Unidade Curricular Análise de Exploratória de Dados, da Licenciatura em Ciência de Dados do Iscte-IUL.

### Introdução

Este relatório apresenta uma análise exploratória dos dados relativos ao estudo "Saúde Psicológica e Bem-Estar", promovido pelo Ministério da Educação em 2022, após o período de pandemia Covid-19. O principal objetivo deste estudo é diagnosticar e compreender o panorama da saúde psicológica e bem-estar das crianças e adolescentes em idade escolar em diferentes regiões de Portugal. Os dados analisados referem-se a um excerto das respostas dos alunos (ou dos seus educadores) ao questionário aplicado.

### Metodologia

A preparação e organização do conjunto de dados e correspondente análise descritiva, em função do contexto e objetivos definidos foi realizada utilizando o Excel, Jamovi e R. 
Começaremos por abordar a descrição dos dados e as questões de qualidade, incluindo tratamento de valores omissos, duplicados e inconsistências. 

```{r setup, include=FALSE, echo=FALSE}
#Importar os ficheiros do Excel
Sys.setlocale("LC_ALL", "Portuguese_Portugal.UTF-8")
library(openxlsx)
bd <- read.xlsx("Trabalho_ecell.xlsx")
head(bd)
```

```{r, include=FALSE, echo=FALSE}
#Mudar o nome de duas variáveis Variáveis da base de dados
colnames(bd)
```

Vou mudar o nome da variável "genero" para "valor_genero" porque já existe uma variável chamada "Género"

```{r, include=FALSE, echo=FALSE}
names(bd)[4] = "valor_genero"
```

Vou mudar o nome da variável "P8_rec" para "satisfacao_vida"

```{r, include=FALSE, echo=FALSE}
names(bd)[9] = "satisfacao_vida"
```

3.  Para identificar os valores omissos da variável "satisfacao_vida", temos de verificar os valores que são iguais a 99, o valor pré-definido para valores omissos

```{r, include=FALSE, echo=FALSE}
paste("Existem",sum(bd$satisfacao_vida == 99),"valores omissos")
```

3.  Imputar os valores omissos da variável "satisfacao_vida"

```{r, include=FALSE, echo=FALSE}
media_antes <- mean(bd$satisfacao_vida)
bd$satisfacao_vida[bd$satisfacao_vida == 99] <- NA
bd$satisfacao_vida[is.na(bd$satisfacao_vida)] <- median(bd$satisfacao_vida, na.rm = TRUE)
media_depois <- mean(bd$satisfacao_vida)
paste("Média antes de inputar os valores omissos:",round(media_antes,2),"\n Média depois de inputar os valores omissos com mediana", round(media_depois,2))
```

5.  Analise descritiva dos dados

Valores descritivos

```{r, include=FALSE, echo=FALSE}
library(DescTools)
library(flextable)
library(descr)
valores <- as.numeric(bd$satisfacao_vida)
descr(valores)

```

```{r, include=TRUE, echo=FALSE}

freq_abs <- table(valores)
freq_rel <- prop.table(freq_abs) * 100

tabela_freq <- data.frame(
  "Valor" = names(freq_abs),
  "Frequência Absoluta" = as.vector(freq_abs),
  "Frequência Relativa (%)" = round(as.vector(freq_rel), 2)
)

# Exibir a tabela
tabela_freq
```

Histograma de frequências absolutas

```{r, include=TRUE, echo=FALSE}

h <- hist(valores,
          main = "Distribuição de Satisfação com a Vida", 
          xlab = "Satisfação com a Vida", 
          ylab = "Frequência", 
          col = "lightblue", 
          )

```

```{r, include=TRUE, echo=FALSE}
boxplot(valores, 
        main = "Boxplot da Satisfação com a Vida", 
        ylab = "Satisfação com a Vida", 
        col = "lightgreen")
```

uni

```{r}
library(ggplot2)

# Definir os 7 títulos (ou sintomas)
specie <- c(
  rep("A", 4),  # 4 repetições para o título "A"
  rep("B", 4),  # 4 repetições para o título "B"
  rep("C", 4),  # 4 repetições para o título "C"
  rep("D", 4),  # 4 repetições para o título "D"
  rep("E", 4),  # 4 repetições para o título "E"
  rep("F", 4),  # 4 repetições para o título "F"
  rep("G", 4)   # 4 repetições para o título "G"
)

# Verificar o comprimento de 'specie'
length(specie)  # Deve retornar 28 (7 títulos * 4 géneros)

# Replicar 'bd$Género' para corresponder ao comprimento de 'specie' (4 géneros por título)
condition <- rep(bd$Género, length.out = length(specie))

# Definir as médias das colunas de ansiedade
mean_values <- c(
  mean(bd$v38_ansiedade),
  mean(bd$v40_ansiedade),
  mean(bd$v43_ansiedade),
  mean(bd$v45_ansiedade),
  mean(bd$v51_ansiedade),
  mean(bd$v55_ansiedade),
  mean(bd$v56_ansiedade)
)

# Replicar as médias para corresponder ao comprimento de 'specie'
value <- rep(mean_values, length.out = length(specie))

# Criar o dataframe
data <- data.frame(specie, condition, value)

# Criar o gráfico de barras agrupadas
ggplot(data, aes(fill = condition, y = value, x = specie)) + 
  geom_bar(position = "dodge", stat = "identity") +
  labs(
    title = "Níveis de Ansiedade por Gênero",
    x = "Sintomas",
    y = "Média de Ansiedade"
  ) 


```
